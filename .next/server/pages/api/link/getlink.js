"use strict";(()=>{var e={};e.id=601,e.ids=[601],e.modules={8013:e=>{e.exports=require("mongodb")},2113:e=>{e.exports=require("next-auth/next")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,o){return o in t?t[o]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,o)):"function"==typeof t&&"default"===o?t:void 0}}})},7721:(e,t,o)=>{o.r(t),o.d(t,{config:()=>f,default:()=>m,routeModule:()=>w});var n={};o.r(n),o.d(n,{default:()=>c});var r=o(1802),a=o(7153),i=o(6249),l=o(1004),s=o(8013),d=o(7309),u=o(2113);let c=async function(e,t){if("GET"!==e.method){t.status(405).json({message:"Method Not Allowed"});return}try{let o;let n=(await (0,l.v)()).db(),r=n.collection("videolinks"),a=n.collection("login"),i=await (0,u.getServerSession)(e,t,d.authOptions);o=i&&"admin"===i.user.role?await r.find({}).toArray():await r.find({status:"active"}).toArray();let c=await Promise.all(o.map(async e=>{let t=await a.findOne({_id:new s.ObjectId(e.user)});if(t){let{password:o,...n}=t;return{...e,user:n}}return e}));t.status(200).json(c)}catch(e){console.error("Error:",e),t.status(500).json({message:"Internal Server Error: Unable to get music"})}},m=(0,i.l)(n,"default"),f=(0,i.l)(n,"config"),w=new r.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/link/getlink",pathname:"/api/link/getlink",bundlePath:"",filename:""},userland:n})},1004:(e,t,o)=>{o.d(t,{v:()=>a});var n=o(8013);let{ObjectId:r}=o(8013);async function a(){let e;try{return e=new n.MongoClient("mongodb+srv://ghufran:Allahis1@cluster0.psik2ae.mongodb.net/deployedplanet?retryWrites=true&w=majority",{connectTimeoutMS:6e5,serverSelectionTimeoutMS:6e4}),console.log("Connecting to MongoDB Atlas cluster..."),await e.connect(),console.log("Successfully connected to MongoDB Atlas!"),e}catch(e){console.error("Connection to MongoDB Atlas failed!",e),process.exit()}}},7309:(e,t,o)=>{o.r(t),o.d(t,{authOptions:()=>s,default:()=>d});let n=require("next-auth");var r=o.n(n);let a=require("next-auth/providers/credentials");var i=o.n(a),l=o(1004);o(8013);let s={providers:[i()({name:"Credentials",async authorize(e){let t=(await (0,l.v)()).db().collection("login"),o=await t.findOne({email:e.email});if(!o)throw Error("User does not exist with this gmail");if(!await t.findOne({password:e.password}))throw Error("Incorrect password!");return{id:o._id,email:o.email,max_download:o.max_download,role:o.role}}})],session:{maxAge:1800},callbacks:{jwt:async({token:e,user:t,trigger:o,session:n})=>("update"===o&&n?.max_download&&(e.max_download=n.max_download),t&&(e.id=t.id,e.max_download=t.max_download,e.role=t.role),e),session:async({session:e,token:t})=>(t&&(e.user.id=t.id,e.user.max_download=t.max_download,e.user.role=t.role),e)},secret:"LlKq6ZtYbr+hTC073mAmAh9/h2HwMfsFo4hrfCx5mLg="},d=r()(s)},7153:(e,t)=>{var o;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return o}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(o||(o={}))},1802:(e,t,o)=>{e.exports=o(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var o=t(t.s=7721);module.exports=o})();